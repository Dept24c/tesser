<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><link href="css/default.css" rel="stylesheet" type="text/css" /><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><script src="js/highlight.min.js" type="text/javascript"></script><link href="css/highlight.css" rel="stylesheet" type="text/css" /><script>hljs.initHighlightingOnLoad();</script><title>tesser.math documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Tesser.all</span> <span class="project-version">1.0.2</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tesser</span></div></div></li><li class="depth-2 branch"><a href="tesser.cardinality.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cardinality</span></div></a></li><li class="depth-2 branch"><a href="tesser.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2"><a href="tesser.hadoop.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hadoop</span></div></a></li><li class="depth-3"><a href="tesser.hadoop.serialization.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>serialization</span></div></a></li><li class="depth-2 branch current"><a href="tesser.math.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>math</span></div></a></li><li class="depth-2 branch"><a href="tesser.quantiles.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>quantiles</span></div></a></li><li class="depth-2 branch"><a href="tesser.simple.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>simple</span></div></a></li><li class="depth-2"><a href="tesser.utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utils</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="tesser.math.html#var-correlation"><div class="inner"><span>correlation</span></div></a></li><li class="depth-1"><a href="tesser.math.html#var-correlation.2Bcount"><div class="inner"><span>correlation+count</span></div></a></li><li class="depth-1"><a href="tesser.math.html#var-correlation.2Bcount-matrix"><div class="inner"><span>correlation+count-matrix</span></div></a></li><li class="depth-1"><a href="tesser.math.html#var-correlation-matrix"><div class="inner"><span>correlation-matrix</span></div></a></li><li class="depth-1"><a href="tesser.math.html#var-covariance"><div class="inner"><span>covariance</span></div></a></li><li class="depth-1"><a href="tesser.math.html#var-covariance-matrix"><div class="inner"><span>covariance-matrix</span></div></a></li><li class="depth-1"><a href="tesser.math.html#var-digest"><div class="inner"><span>digest</span></div></a></li><li class="depth-1"><a href="tesser.math.html#var-fuse-matrix"><div class="inner"><span>fuse-matrix</span></div></a></li><li class="depth-1"><a href="tesser.math.html#var-mean"><div class="inner"><span>mean</span></div></a></li><li class="depth-1"><a href="tesser.math.html#var-standard-deviation"><div class="inner"><span>standard-deviation</span></div></a></li><li class="depth-1"><a href="tesser.math.html#var-sum"><div class="inner"><span>sum</span></div></a></li><li class="depth-1"><a href="tesser.math.html#var-variance"><div class="inner"><span>variance</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">tesser.math</h1><div class="doc"><div class="markdown"><p>Folds over numbers! Calculate sums, means, variance, standard deviation, covariance and linear correlations, and matrices thereof, plus quantiles and histograms estimates backed by probabilistic QDigests.</p></div></div><div class="public anchor" id="var-correlation"><h3>correlation</h3><div class="usage"><code>(correlation &amp; args)</code></div><div class="doc"><div class="markdown"><p>Like correlation+count, but only returns the correlation.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/tesser/blob/1.0.2/../math/src/tesser/math.clj#L212">view source</a></div></div><div class="public anchor" id="var-correlation.2Bcount"><h3>correlation+count</h3><div class="usage"><code>(correlation+count fx fy)</code><code>(correlation+count fx fy fold__4766__auto__)</code></div><div class="doc"><div class="markdown"><p>Given two functions: (fx input) and (fy input), each of which returns a number, estimates the unbiased linear correlation coefficient between fx and fy over inputs. Ignores any records where fx or fy are nil. If there are no records with values for fx and fy, the correlation is nil. See <a href="http://mathworld.wolfram.com/CorrelationCoefficient.html">http://mathworld.wolfram.com/CorrelationCoefficient.html</a>.</p>
<p>This function returns a map of correlation and count, like</p>
<pre><code>{:correlation 0.34 :count 142}
</code></pre>
<p>which is useful for significance testing.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/tesser/blob/1.0.2/../math/src/tesser/math.clj#L147">view source</a></div></div><div class="public anchor" id="var-correlation.2Bcount-matrix"><h3>correlation+count-matrix</h3><div class="usage"><code>(correlation+count-matrix &amp; args)</code></div><div class="doc"><div class="markdown"><p>Given a map of key names to functions that extract values for those keys from an input, computes the correlations for each of the n^2 key pairs, returning a map of name pairs to the their correlations and counts. See correlation+count. For example:</p>
<pre><code>(t/correlation-matrix {:name-length #(.length (:name %))
                      :age         :age
                      :num-cats    (comp count :cats)})
</code></pre>
<p>will, when executed, returns a map like</p>
<pre><code>{[:name-length :age]      {:count 150 :correlation 0.56}
 [:name-length :num-cats] {:count 150 :correlation 0.95}
 ...}
</code></pre></div></div><div class="src-link"><a href="http://github.com/aphyr/tesser/blob/1.0.2/../math/src/tesser/math.clj#L194">view source</a></div></div><div class="public anchor" id="var-correlation-matrix"><h3>correlation-matrix</h3><div class="usage"><code>(correlation-matrix &amp; args)</code></div><div class="doc"><div class="markdown"><p>Like correlation+count-matrix, but returns just correlations coefficients instead of maps of :correlation and :count.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/tesser/blob/1.0.2/../math/src/tesser/math.clj#L219">view source</a></div></div><div class="public anchor" id="var-covariance"><h3>covariance</h3><div class="usage"><code>(covariance fx fy)</code><code>(covariance fx fy fold__4766__auto__)</code></div><div class="doc"><div class="markdown"><p>Given two functions of an input <code>(fx input)</code> and <code>(fy input)</code>, each of which returns a number, estimates the unbiased covariance of those functions over inputs.</p>
<p>Ignores any inputs where <code>(fx input)</code> or <code>(fy input)</code> are nil. If no inputs have both x and y, returns nil.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/tesser/blob/1.0.2/../math/src/tesser/math.clj#L66">view source</a></div></div><div class="public anchor" id="var-covariance-matrix"><h3>covariance-matrix</h3><div class="usage"><code>(covariance-matrix &amp; args)</code></div><div class="doc"><div class="markdown"><p>Given a map of key names to functions that extract values for those keys from an input, computes the covariance for each of the n^2 key pairs, returning a map of name pairs to the their covariance. For example:</p>
<pre><code>(t/covariance-matrix {:name-length #(.length (:name %))
                      :age         :age
                      :num-cats    (comp count :cats)})
</code></pre></div></div><div class="src-link"><a href="http://github.com/aphyr/tesser/blob/1.0.2/../math/src/tesser/math.clj#L136">view source</a></div></div><div class="public anchor" id="var-digest"><h3>digest</h3><div class="usage"><code>(digest digest-generator)</code><code>(digest digest-generator fold__4766__auto__)</code></div><div class="doc"><div class="markdown"><p>You’ve got a set of numeric inputs and want to know their quantiles distribution, histogram, etc. This fold takes numeric inputs and produces a statistical estimate of their distribution.</p>
<p><code>digest</code> takes a function that returns a <code>tesser.quantiles/Digest</code>. The fold returns an instance of that digest.</p>
<p>For example, to compute an HDRHistogram over both positive and negative doubles (or longs, rationals, etc):</p>
<p>Compute a digest using e.g.</p>
<pre><code>(def digest (-&gt;&gt; (m/digest q/hdr-histogram)
                 (t/tesser [[1 1 1 1 1 1 2 2 2 3 3 4 5]])))
; =&gt; #&lt;DoubleHistogram ...&gt;
</code></pre>
<p>To specify options for the digest, just use partial or (fn [] …)</p>
<pre><code>(m/digest (partial q/hdr-histogram {:significant-value-digits 4
                                    :highest-to-lowest-value-ratio 1e6}))
</code></pre>
<p>DoubleHistogram, like many quantile estimators, only works over positive values. To cover positives and negatives together, use <code>tesser.quantiles/dual</code>:</p>
<pre><code>(m/digest #(q/dual q/hdr-histogram {:significant-value-digits 2}))
</code></pre>
<p>Once you’ve computed a digest, you can find a particular quantile using <code>tesser.quantiles/quantile</code></p>
<pre><code>(q/quantile digest 0)   ; =&gt; 1.0
(q/quantile digest 0.5) ; =&gt; 1.0
(q/quantile digest 4/5) ; =&gt; 2.0009765625
(q/quantile digest 1)   ; =&gt; 3.0009765625
</code></pre>
<p>The total number of points in the sample:</p>
<pre><code>(q/point-count digest) ; =&gt; 5
</code></pre>
<p>Minima and maxima:</p>
<pre><code>(q/min digest) ; =&gt; 1.0
(q/max digest) ; =&gt; 3.0009765625
</code></pre>
<p>Or find the distribution of values less than or equal to each point, with resolution given by the internal granularity of the digest:</p>
<pre><code>(q/distribution digest)
; =&gt; ([1.0 3] [2.0009765625 1] [3.0009765625 1])

(q/cumulative-distribution digest)
; =&gt; ([1.0 3] [2.0009765625 4] [3.0009765625 5])
</code></pre>
<p>You don’t have to return the whole digest; any of these derivative operations can be merged directly into the fold via <code>tesser.core/post-combine</code>.</p>
<pre><code>(-&gt;&gt; (m/digest q/hdr-histogram)
     (t/post-combine #(q/quantile % 1/2))
     (t/tesser [[1 2 2 3 3 3 3 3 3 3 3]]))
; =&gt; 3.0009765625
</code></pre>
<p>You may also use <code>tesser.cardinality/hll</code> for estimating the cardinality of a set. HLL+ uses a probabilistic data-structure to compute set cardinality using very little memory with accuracy tradeoffs.</p>
<p>The HLL digest can be used like the above mentioned histograms:</p>
<pre><code>(def digest (-&gt;&gt; (m/digest cardinality/hll)
                 (t/tesser [[1 1 1 1 1 1 2 2 2 3 3 4 5]])))
; =&gt; #&lt;HyperLogLogPlus...&gt;
</code></pre>
<p>Getting the cardinality out through a post-combine step:</p>
<pre><code>(-&gt;&gt; (m/digest cardinality/hll)
     (t/post-combine #(q/point-count %))
     (t/tesser [[1 2 2 3 3 3 3 3 3 3 3]]))
; =&gt; 3
</code></pre>
<p>I want to emphasize that depending on the size of your data, its distribution, and the number of digests you want to compute, you may need different digest algorithms and widely varying tuning parameters. Until we have a better grasp of the space/error tradeoffs here, I won’t choose defaults for you.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/tesser/blob/1.0.2/../math/src/tesser/math.clj#L225">view source</a></div></div><div class="public anchor" id="var-fuse-matrix"><h3>fuse-matrix</h3><div class="usage"><code>(fuse-matrix fold keymap &amp; [downstream])</code></div><div class="doc"><div class="markdown"><p>Given:</p>
<ol>
  <li>A function like <code>covariance</code> that takes two functions of an input and  yields a fold, and</li>
  <li>A map of key names to functions that extract values for  those keys from an input,</li>
</ol>
<p>pairwise-matrix computes that fold over each <em>pair</em> of keys, returning a map of name pairs to the result of that pairwise fold over the inputs. You can think of this like an N^2 version of <code>fuse</code>.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/tesser/blob/1.0.2/../math/src/tesser/math.clj#L103">view source</a></div></div><div class="public anchor" id="var-mean"><h3>mean</h3><div class="usage"><code>(mean)</code><code>(mean fold__4766__auto__)</code></div><div class="doc"><div class="markdown"><p>Finds the arithmetic mean of numeric inputs.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/tesser/blob/1.0.2/../math/src/tesser/math.clj#L25">view source</a></div></div><div class="public anchor" id="var-standard-deviation"><h3>standard-deviation</h3><div class="usage"><code>(standard-deviation &amp; [f])</code></div><div class="doc"><div class="markdown"><p>Estimates the standard deviation of numeric inputs.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/tesser/blob/1.0.2/../math/src/tesser/math.clj#L61">view source</a></div></div><div class="public anchor" id="var-sum"><h3>sum</h3><div class="usage"><code>(sum)</code><code>(sum fold__4766__auto__)</code></div><div class="doc"><div class="markdown"><p>Finds the sum of numeric elements.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/tesser/blob/1.0.2/../math/src/tesser/math.clj#L14">view source</a></div></div><div class="public anchor" id="var-variance"><h3>variance</h3><div class="usage"><code>(variance)</code><code>(variance fold__4766__auto__)</code></div><div class="doc"><div class="markdown"><p>Unbiased variance estimation. Given numeric inputs, returns their variance.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/tesser/blob/1.0.2/../math/src/tesser/math.clj#L38">view source</a></div></div></div></body></html>